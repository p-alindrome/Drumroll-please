<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>ü•Å Drumroll, Please</title>

    <style>
        body {
            margin: 0;
            min-height: 100vh;
            font-family: system-ui, sans-serif;
            background: radial-gradient(circle at top, #e0c3fc, #8ec5fc);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .app {
            background: white;
            border-radius: 22px;
            padding: 30px;
            width: 100%;
            max-width: 420px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        h1 {
            margin: 0;
            font-size: 2.4rem;
        }

        .subtitle {
            opacity: 0.7;
            margin: 8px 0 20px;
        }

        .row {
            display: flex;
            gap: 8px;
        }

        input {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid #eee;
            font-size: 16px;
        }

        button {
            padding: 12px 16px;
            border-radius: 12px;
            border: none;
            color: white;
            font-weight: 700;
            cursor: pointer;
            background: #9b5de5;
            box-shadow: 0 6px 0 #7a3fd2;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #e76610;
        }

        ul {
            list-style: none;
            padding: 0;
            margin: 18px 0 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        li {
            font-size: 18px;
            padding: 4px 0;
            background: #eee;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        li:hover {
            transform: scale(1.05);
            background: #ddd;
        }

        .controls {
            display: flex;
            justify-content: center;
            margin: 10px 0;
            font-size: 14px;
        }

        .controls label {
            cursor: pointer;
        }

        .drumroll {
            width: 100%;
            margin-top: 16px;
            font-size: 18px;
        }

        .clear-all {
            background: #c77dff;        /* pinky purple */
            box-shadow: 0 6px 0 #a64dff; /* darker shadow */
            color: white;
            font-weight: 700;
            border-radius: 12px;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clear-all:hover {
            background: #ff7bff;
            box-shadow: 0 6px 0 #b35dff;
            transform: translateY(-2px);
        }


        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #7a3fd2; /* main button shadow */
        }

        .stage {
            min-height: 90px;
            margin-top: 24px;
            font-size: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rolling {
            animation: pulse 0.8s infinite;
        }

        .winner {
            font-size: 36px;
            animation: pop 0.6s ease;
        }

        canvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
        }

        .stage.winner {
            font-size: 36px;
            animation: pop 0.6s ease;
            color: #9b5de5; /* stage text in purple */
        }

        @keyframes pop {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            60% {
                transform: scale(1.4);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes pulse {
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes pop {
            from {
                transform: scale(0.6);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body>

<div class="app">
    <h1>ü•Å Drumroll, Please</h1>
    <div class="subtitle">Every decision deserves drama.</div>

    <div class="row">
        <input id="input" placeholder="Add a person, task, or idea‚Ä¶" />
        <button onclick="addItem()">Add</button>
        <button class="clear-all" onclick="clearAll()">üßπ Clear All</button>
    </div>
    <ul id="list"></ul>

    <div class="controls">
        <label>
            <input type="checkbox" id="removeAfter"/>
            Remove after pick
        </label>
    </div>

    <button class="drumroll" onclick="start()">Start the Drumroll</button>

    <div class="stage" id="stage"></div>
</div>

<canvas id="confetti"></canvas>

<script>
    const input = document.getElementById("input");
    const listEl = document.getElementById("list");
    const stage = document.getElementById("stage");
    const removeAfter = document.getElementById("removeAfter");
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");

    let items = JSON.parse(localStorage.getItem("drumroll-items")) || [];
    render();

    function save() {
        localStorage.setItem("drumroll-items", JSON.stringify(items));
    }

    function addItem() {
        const v = input.value.trim();
        if (!v) return;
        items.push(v);
        input.value = "";
        save();
        render();
    }

    function render() {
        listEl.innerHTML = "";
        items.forEach(i => {
            const li = document.createElement("li");
            li.textContent = "‚Ä¢ " + i;
            listEl.appendChild(li);
        });
    }

    function playDrumroll() {
        const audioCtx = new AudioContext();
        let t = audioCtx.currentTime;

        const beats = 12;
        const gap = 0.18;

        for (let i = 0; i < beats; i++) {
            const osc = audioCtx.createOscillator();
            osc.frequency.value = 90;
            osc.connect(audioCtx.destination);
            osc.start(t);
            osc.stop(t + 0.05);
            t += gap;
        }

        // return total duration in ms
        return beats * gap * 1000;
    }


    function start() {
        if (!items.length) {
            stage.textContent = "Even drama needs options üòÖ";
            return;
        }

        const drumrollDuration = playDrumroll();
        stage.className = "stage rolling";

        const lines = [
            "wait for it‚Ä¶",
            "big moment‚Ä¶",
            "hold applause‚Ä¶",
            "consulting the universe‚Ä¶"
        ];

        let i = 0;
        const roll = setInterval(() => {
            stage.textContent = lines[i++ % lines.length];
        }, 500);

        setTimeout(() => {
            clearInterval(roll);

            const index = Math.floor(Math.random() * items.length);
            const winner = items[index];

            // Dim non-winners, but don't scale or glow winner in grid
            const listItems = document.querySelectorAll("#list li");
            listItems.forEach((li, i) => {
                li.style.transition = "all 0.3s ease";
                li.style.opacity = "0.6"; // dim all items slightly
                li.style.transform = "scale(1)"; // no scale
                li.style.background = "#eee"; // keep background normal
                li.style.color = "#333";       // normal text color
            });

            // Only mark the stage with winner
            stage.className = "stage winner"; // you can remove glow in CSS
            stage.textContent = `ü•Å ${winner} ü•Å`;

            // Confetti around stage/winner
            confetti();

            // Remove after pick if checked
            if (removeAfter.checked) {
                items.splice(index, 1);
                save();
                render();
            }
        }, drumrollDuration + 300);



    }

    function confetti() {
        const winnerLi = document.querySelector("#list li.winner") || stage;
        const rect = winnerLi.getBoundingClientRect();

        const pieces = Array.from({length: 50}, () => ({
            x: rect.left + rect.width / 2,
            y: rect.top + rect.height / 2,
            dx: (Math.random() - 0.5) * 6,
            dy: (Math.random() - 0.5) * 6,
            r: Math.random() * 4 + 2,
            alpha: 1,
            color: `hsl(${Math.random() * 360}, 80%, 60%)`  // colorful particles!
        }));

        const canvas = document.getElementById("confetti");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const ctx = canvas.getContext("2d");
        let frame = 0;

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            pieces.forEach(p => {
                p.x += p.dx;
                p.y += p.dy;
                p.alpha -= 0.02;
                if (p.alpha > 0) {
                    ctx.fillStyle = p.color.replace('hsl', 'hsla').replace(')', `,${p.alpha})`);
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            frame++;
            if (frame < 50) requestAnimationFrame(draw);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        draw();
    }


    function clearAll() {
        if (!items.length) return;

        const confirmClear = confirm("Are you sure you want to clear all items?");
        if (!confirmClear) return;

        const listItems = document.querySelectorAll("#list li");
        const stageEl = document.getElementById("stage");

        // Animate list items
        listItems.forEach(li => animateTextPoof(li));

        // Animate stage text
        if (stageEl.textContent.trim()) {
            animateTextPoof(stageEl);
        }

        // Clear items & localStorage after animation
        setTimeout(() => {
            items = [];
            save();
        }, 800);
    }

    // Function to animate a single element with poof blur + tiny particles
    function animateTextPoof(el) {
        const rect = el.getBoundingClientRect();
        const computedStyle = getComputedStyle(el);
        const color = computedStyle.color;

        // Create particles
        const particleCount = 20;
        const particles = [];
        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: rect.left + rect.width / 2,
                y: rect.top + rect.height / 2,
                dx: (Math.random() - 0.5) * 8,
                dy: (Math.random() - 0.5) * 8,
                r: Math.random() * 3 + 2,
                alpha: 1,
                color
            });
        }

        // Blur + fade out the element itself
        el.style.transition = "all 0.8s ease";
        el.style.filter = "blur(6px)";
        el.style.opacity = "0";
        el.style.transform = "scale(0.5)";

        setTimeout(() => el.remove(), 800);

        // Animate particles on canvas
        const canvas = document.getElementById("confetti");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const ctx = canvas.getContext("2d");
        let frame = 0;

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach(p => {
                p.x += p.dx;
                p.y += p.dy;
                p.alpha -= 0.02;
                if (p.alpha > 0) {
                    ctx.fillStyle = `rgba(${colorToRGB(p.color)}, ${p.alpha})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            frame++;
            if (frame < 50) requestAnimationFrame(draw);
            else ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        draw();
    }

    // Helper: converts CSS color string like "rgb(45, 45, 45)" to array [45,45,45]
    function colorToRGB(str) {
        const match = str.match(/\d+/g);
        if (match) return `${match[0]},${match[1]},${match[2]}`;
        return "0,0,0";
    }


</script>

</body>
</html>
